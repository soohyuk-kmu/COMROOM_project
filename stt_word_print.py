import speech_recognition as sr  # ğŸ¤ ìŒì„± â†’ í…ìŠ¤íŠ¸ ë³€í™˜ ë¼ì´ë¸ŒëŸ¬ë¦¬

# ---------------------------------------------
# ğŸ“Œ ì¡°ì‚¬ ë¦¬ìŠ¤íŠ¸ (ê¸´ ì¡°ì‚¬ â†’ ì§§ì€ ì¡°ì‚¬ ìˆœì„œ)
# ---------------------------------------------
particles = [
    "ì´ë‘", "ë‘", "í•˜ê³ ", "ê³¼", "ì™€",
    "ì—ì„œ", "ìœ¼ë¡œ", "ë¡œ",
    "ì€", "ëŠ”", "ì´", "ê°€", "ì„", "ë¥¼", "ì—"
]

# ---------------------------------------------
# ğŸ“Œ ì¡°ì‚¬ ë¶„ë¦¬ í•¨ìˆ˜
#    ì˜ˆ: "ë…¸íŠ¸ë‘" â†’ ["ë…¸íŠ¸", "ë‘"]
# ---------------------------------------------
def split_particle(word):
    # ê¸´ ì¡°ì‚¬ë¶€í„° ê²€ì‚¬í•´ì•¼ ì •í™•í•œ ë¶„ë¦¬ê°€ ë¨
    for p in particles:
        if word.endswith(p):              # ë‹¨ì–´ê°€ ì¡°ì‚¬ë¡œ ëë‚˜ëŠ” ê²½ìš°
            stem = word[:-len(p)]         # ì¡°ì‚¬ ì œê±°í•œ 'ì›ë˜ ë‹¨ì–´'
            return [stem, p]              # ["ë…¸íŠ¸", "ë‘"]ì²˜ëŸ¼ ë°˜í™˜
    return [word]                         # ì¡°ì‚¬ ì—†ìœ¼ë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜

# ---------------------------------------------
# ğŸ“Œ STT ì¤€ë¹„
# ---------------------------------------------
r = sr.Recognizer()

with sr.Microphone() as source:
    print("ë§í•˜ì„¸ìš”...")
    audio = r.listen(source)

# ---------------------------------------------
# ğŸ“Œ ìŒì„± â†’ í…ìŠ¤íŠ¸ ë³€í™˜
# ---------------------------------------------
try:
    text = r.recognize_google(audio, language="ko-KR")
    print("\nğŸ¤ ì¸ì‹ëœ ë¬¸ì¥:", text)

    # -------------------------------------------------
    # ğŸ“Œ 1) ê¸°ë³¸ ê³µë°± ë¶„ë¦¬
    # -------------------------------------------------
    raw_words = text.split()

    # -------------------------------------------------
    # ğŸ“Œ 2) ì¡°ì‚¬ ë‹¨ìœ„ê¹Œì§€ ë¶„ë¦¬í•œ í† í° ë¦¬ìŠ¤íŠ¸ ë§Œë“¤ê¸°
    # -------------------------------------------------
    extracted_words = []                # ìµœì¢… í† í° ì €ì¥ ë¦¬ìŠ¤íŠ¸
    for w in raw_words:
        parts = split_particle(w)       # ì¡°ì‚¬ ë¶„ë¦¬ ìˆ˜í–‰
        extracted_words.extend(parts)   # ê²°ê³¼ í† í° ì¶”ê°€

    # -------------------------------------------------
    # ğŸ“Œ 3) ì¡°ì‚¬ ë‹¨ìœ„ê¹Œì§€ ë¶„ë¦¬ëœ ë‹¨ì–´ë“¤ ì¶œë ¥
    # -------------------------------------------------
    print("\nğŸ“Œ ì¡°ì‚¬ í¬í•¨ ë‹¨ìœ„ë¡œ ë¶„ë¦¬ëœ ë‹¨ì–´ë“¤:")
    for token in extracted_words:
        print("-", token)

except sr.UnknownValueError:
    print("ìŒì„± ì¸ì‹ ì‹¤íŒ¨")
except sr.RequestError:
    print("STT ì„œë²„ ì˜¤ë¥˜")
